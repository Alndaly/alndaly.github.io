"use strict";(self.webpackChunkalndaly_github_io=self.webpackChunkalndaly_github_io||[]).push([[1955],{3881:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>d});var r=s(8101);const i={},l=r.createContext(i);function t(e){const n=r.useContext(l);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),r.createElement(l.Provider,{value:n},e.children)}},5762:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>p,frontMatter:()=>t,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"backend/Node/Koa/\u54cd\u5e94","title":"\u54cd\u5e94(Response)","description":"Koa Response \u5bf9\u8c61\u662f\u5728 node \u7684\u539f\u751f\u54cd\u5e94\u5bf9\u8c61\u4e4b\u4e0a\u7684\u62bd\u8c61\uff0c\u63d0\u4f9b\u4e86\u8bf8\u591a\u5bf9 HTTP \u670d\u52a1\u5668\u5f00\u53d1\u6709\u7528\u7684\u529f\u80fd\u3002","source":"@site/docs/backend/Node/Koa/\u54cd\u5e94.md","sourceDirName":"backend/Node/Koa","slug":"/backend/Node/Koa/\u54cd\u5e94","permalink":"/en/docs/backend/Node/Koa/\u54cd\u5e94","draft":false,"unlisted":false,"editUrl":"https://github.com/Alndaly/alndaly.github.io/tree/main/packages/create-docusaurus/templates/shared/docs/backend/Node/Koa/\u54cd\u5e94.md","tags":[],"version":"current","lastUpdatedAt":1742398290000,"sidebarPosition":8,"frontMatter":{"title":"\u54cd\u5e94(Response)","sidebar_position":8},"sidebar":"backEndSidebar","previous":{"title":"\u8bf7\u6c42(Request)","permalink":"/en/docs/backend/Node/Koa/\u8bf7\u6c42"},"next":{"title":"SpringSecurity","permalink":"/en/docs/backend/Spring/SpringSecurity"}}');var i=s(5105),l=s(3881);const t={title:"\u54cd\u5e94(Response)",sidebar_position:8},d=void 0,a={},o=[{value:"API",id:"api",level:2},{value:"response.header",id:"responseheader",level:3},{value:"response.headers",id:"responseheaders",level:3},{value:"response.socket",id:"responsesocket",level:3},{value:"response.status",id:"responsestatus",level:3},{value:"response.status=",id:"responsestatus-1",level:3},{value:"response.message",id:"responsemessage",level:3},{value:"response.message=",id:"responsemessage-1",level:3},{value:"response.length=",id:"responselength",level:3},{value:"response.length",id:"responselength-1",level:3},{value:"response.body",id:"responsebody",level:3},{value:"response.body=",id:"responsebody-1",level:3},{value:"String",id:"string",level:4},{value:"Buffer",id:"buffer",level:4},{value:"Stream",id:"stream",level:4},{value:"Object",id:"object",level:4},{value:"response.get(field)",id:"responsegetfield",level:3},{value:"response.has(field)",id:"responsehasfield",level:3},{value:"response.append(field, value)",id:"responseappendfield-value",level:3},{value:"response.set(fields)",id:"responsesetfields",level:3},{value:"response.remove(field)",id:"responseremovefield",level:3},{value:"response.type",id:"responsetype",level:3},{value:"response.type=",id:"responsetype-1",level:3},{value:"response.is(types...)",id:"responseistypes",level:3},{value:"response.redirect(url, [alt])",id:"responseredirecturl-alt",level:3},{value:"response.attachment([filename], [options])",id:"responseattachmentfilename-options",level:3},{value:"response.headerSent",id:"responseheadersent",level:3},{value:"response.lastModified",id:"responselastmodified",level:3},{value:"response.lastModified=",id:"responselastmodified-1",level:3},{value:"response.etag=",id:"responseetag",level:3},{value:"response.vary(field)",id:"responsevaryfield",level:3},{value:"response.flushHeaders()",id:"responseflushheaders",level:3}];function c(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Koa Response \u5bf9\u8c61\u662f\u5728 node \u7684\u539f\u751f\u54cd\u5e94\u5bf9\u8c61\u4e4b\u4e0a\u7684\u62bd\u8c61\uff0c\u63d0\u4f9b\u4e86\u8bf8\u591a\u5bf9 HTTP \u670d\u52a1\u5668\u5f00\u53d1\u6709\u7528\u7684\u529f\u80fd\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"api",children:"API"}),"\n",(0,i.jsx)(n.h3,{id:"responseheader",children:"response.header"}),"\n",(0,i.jsx)(n.p,{children:"\u54cd\u5e94\u5934\u5bf9\u8c61\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"responseheaders",children:"response.headers"}),"\n",(0,i.jsx)(n.p,{children:"\u54cd\u5e94\u5934\u5bf9\u8c61\u3002\u522b\u540d\u662f response.header\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"responsesocket",children:"response.socket"}),"\n",(0,i.jsx)(n.p,{children:"\u54cd\u5e94\u5957\u63a5\u5b57\u3002 \u4f5c\u4e3a request.socket \u6307\u5411 net.Socket \u5b9e\u4f8b\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"responsestatus",children:"response.status"}),"\n",(0,i.jsx)(n.p,{children:"\u83b7\u53d6\u54cd\u5e94\u72b6\u6001\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cresponse.status \u8bbe\u7f6e\u4e3a 404 \u800c\u4e0d\u662f\u50cf node \u7684 res.statusCode \u90a3\u6837\u9ed8\u8ba4\u4e3a 200\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"responsestatus-1",children:"response.status="}),"\n",(0,i.jsx)(n.p,{children:"\u901a\u8fc7\u6570\u5b57\u4ee3\u7801\u8bbe\u7f6e\u54cd\u5e94\u72b6\u6001\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:'100 "continue"'}),"\n",(0,i.jsx)(n.li,{children:'101 "switching protocols"'}),"\n",(0,i.jsx)(n.li,{children:'102 "processing"'}),"\n",(0,i.jsx)(n.li,{children:'200 "ok"'}),"\n",(0,i.jsx)(n.li,{children:'201 "created"'}),"\n",(0,i.jsx)(n.li,{children:'202 "accepted"'}),"\n",(0,i.jsx)(n.li,{children:'203 "non-authoritative information"'}),"\n",(0,i.jsx)(n.li,{children:'204 "no content"'}),"\n",(0,i.jsx)(n.li,{children:'205 "reset content"'}),"\n",(0,i.jsx)(n.li,{children:'206 "partial content"'}),"\n",(0,i.jsx)(n.li,{children:'207 "multi-status"'}),"\n",(0,i.jsx)(n.li,{children:'208 "already reported"'}),"\n",(0,i.jsx)(n.li,{children:'226 "im used"'}),"\n",(0,i.jsx)(n.li,{children:'300 "multiple choices"'}),"\n",(0,i.jsx)(n.li,{children:'301 "moved permanently"'}),"\n",(0,i.jsx)(n.li,{children:'302 "found"'}),"\n",(0,i.jsx)(n.li,{children:'303 "see other"'}),"\n",(0,i.jsx)(n.li,{children:'304 "not modified"'}),"\n",(0,i.jsx)(n.li,{children:'305 "use proxy"'}),"\n",(0,i.jsx)(n.li,{children:'307 "temporary redirect"'}),"\n",(0,i.jsx)(n.li,{children:'308 "permanent redirect"'}),"\n",(0,i.jsx)(n.li,{children:'400 "bad request"'}),"\n",(0,i.jsx)(n.li,{children:'401 "unauthorized"'}),"\n",(0,i.jsx)(n.li,{children:'402 "payment required"'}),"\n",(0,i.jsx)(n.li,{children:'403 "forbidden"'}),"\n",(0,i.jsx)(n.li,{children:'404 "not found"'}),"\n",(0,i.jsx)(n.li,{children:'405 "method not allowed"'}),"\n",(0,i.jsx)(n.li,{children:'406 "not acceptable"'}),"\n",(0,i.jsx)(n.li,{children:'407 "proxy authentication required"'}),"\n",(0,i.jsx)(n.li,{children:'408 "request timeout"'}),"\n",(0,i.jsx)(n.li,{children:'409 "conflict"'}),"\n",(0,i.jsx)(n.li,{children:'410 "gone"'}),"\n",(0,i.jsx)(n.li,{children:'411 "length required"'}),"\n",(0,i.jsx)(n.li,{children:'412 "precondition failed"'}),"\n",(0,i.jsx)(n.li,{children:'413 "payload too large"'}),"\n",(0,i.jsx)(n.li,{children:'414 "uri too long"'}),"\n",(0,i.jsx)(n.li,{children:'415 "unsupported media type"'}),"\n",(0,i.jsx)(n.li,{children:'416 "range not satisfiable"'}),"\n",(0,i.jsx)(n.li,{children:'417 "expectation failed"'}),"\n",(0,i.jsx)(n.li,{children:'418 "I\'m a teapot"'}),"\n",(0,i.jsx)(n.li,{children:'422 "unprocessable entity"'}),"\n",(0,i.jsx)(n.li,{children:'423 "locked"'}),"\n",(0,i.jsx)(n.li,{children:'424 "failed dependency"'}),"\n",(0,i.jsx)(n.li,{children:'426 "upgrade required"'}),"\n",(0,i.jsx)(n.li,{children:'428 "precondition required"'}),"\n",(0,i.jsx)(n.li,{children:'429 "too many requests"'}),"\n",(0,i.jsx)(n.li,{children:'431 "request header fields too large"'}),"\n",(0,i.jsx)(n.li,{children:'500 "internal server error"'}),"\n",(0,i.jsx)(n.li,{children:'501 "not implemented"'}),"\n",(0,i.jsx)(n.li,{children:'502 "bad gateway"'}),"\n",(0,i.jsx)(n.li,{children:'503 "service unavailable"'}),"\n",(0,i.jsx)(n.li,{children:'504 "gateway timeout"'}),"\n",(0,i.jsx)(n.li,{children:'505 "http version not supported"'}),"\n",(0,i.jsx)(n.li,{children:'506 "variant also negotiates"'}),"\n",(0,i.jsx)(n.li,{children:'507 "insufficient storage"'}),"\n",(0,i.jsx)(n.li,{children:'508 "loop detected"'}),"\n",(0,i.jsx)(n.li,{children:'510 "not extended"'}),"\n",(0,i.jsx)(n.li,{children:'511 "network authentication required"'}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u6ce8\u610f: \u4e0d\u7528\u592a\u5728\u610f\u8bb0\u4f4f\u8fd9\u4e9b\u5b57\u7b26\u4e32, \u5982\u679c\u4f60\u5199\u9519\u4e86,\u53ef\u4ee5\u67e5\u9605\u8fd9\u4e2a\u5217\u8868\u968f\u65f6\u66f4\u6b63."}),"\n",(0,i.jsx)(n.p,{children:"\u7531\u4e8e response.status \u9ed8\u8ba4\u8bbe\u7f6e\u4e3a 404\uff0c\u56e0\u6b64\u53d1\u9001\u6ca1\u6709 body \u4e14\u72b6\u6001\u4e0d\u540c\u7684\u54cd\u5e94\u7684\u64cd\u4f5c\u5982\u4e0b\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"ctx.response.status = 200;\n\n// \u6216\u5176\u4ed6\u4efb\u4f55\u72b6\u6001\nctx.response.status = 204;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"responsemessage",children:"response.message"}),"\n",(0,i.jsx)(n.p,{children:"\u83b7\u53d6\u54cd\u5e94\u7684\u72b6\u6001\u6d88\u606f. \u9ed8\u8ba4\u60c5\u51b5\u4e0b, response.message \u4e0e response.status \u5173\u8054."}),"\n",(0,i.jsx)(n.h3,{id:"responsemessage-1",children:"response.message="}),"\n",(0,i.jsx)(n.p,{children:"\u5c06\u54cd\u5e94\u7684\u72b6\u6001\u6d88\u606f\u8bbe\u7f6e\u4e3a\u7ed9\u5b9a\u503c\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"responselength",children:"response.length="}),"\n",(0,i.jsx)(n.p,{children:"\u5c06\u54cd\u5e94\u7684 Content-Length \u8bbe\u7f6e\u4e3a\u7ed9\u5b9a\u503c\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"responselength-1",children:"response.length"}),"\n",(0,i.jsx)(n.p,{children:"\u4ee5\u6570\u5b57\u8fd4\u56de\u54cd\u5e94\u7684 Content-Length\uff0c\u6216\u8005\u4ecectx.body\u63a8\u5bfc\u51fa\u6765\uff0c\u6216\u8005undefined\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"responsebody",children:"response.body"}),"\n",(0,i.jsx)(n.p,{children:"\u83b7\u53d6\u54cd\u5e94\u4e3b\u4f53\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"responsebody-1",children:"response.body="}),"\n",(0,i.jsx)(n.p,{children:"\u5c06\u54cd\u5e94\u4f53\u8bbe\u7f6e\u4e3a\u4ee5\u4e0b\u4e4b\u4e00\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"string \u5199\u5165"}),"\n",(0,i.jsx)(n.li,{children:"Buffer \u5199\u5165"}),"\n",(0,i.jsx)(n.li,{children:"Stream \u7ba1\u9053"}),"\n",(0,i.jsx)(n.li,{children:"Object || Array JSON-\u5b57\u7b26\u4e32\u5316"}),"\n",(0,i.jsx)(n.li,{children:"null \u65e0\u5185\u5bb9\u54cd\u5e94"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u5982\u679c response.status \u672a\u88ab\u8bbe\u7f6e, Koa \u5c06\u4f1a\u81ea\u52a8\u8bbe\u7f6e\u72b6\u6001\u4e3a 200 \u6216 204\u3002"}),"\n",(0,i.jsx)(n.p,{children:"Koa \u6ca1\u6709\u9632\u8303\u4f5c\u4e3a\u54cd\u5e94\u4f53\u7684\u6240\u6709\u5185\u5bb9 - \u51fd\u6570\u6ca1\u6709\u6709\u610f\u4e49\u5730\u5e8f\u5217\u5316\uff0c\u8fd4\u56de\u5e03\u5c14\u503c\u53ef\u80fd\u4f1a\u6839\u636e\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u800c\u6709\u610f\u4e49\u3002\u5e76\u4e14\u5f53\u9519\u8bef\u751f\u6548\u65f6\uff0c\u5b83\u53ef\u80fd\u65e0\u6cd5\u6b63\u5e38\u5de5\u4f5c \u9519\u8bef\u7684\u5c5e\u6027\u65e0\u6cd5\u679a\u4e3e\u3002 \u6211\u4eec\u5efa\u8bae\u5728\u60a8\u7684\u5e94\u7528\u4e2d\u6dfb\u52a0\u4e2d\u95f4\u4ef6\uff0c\u4ee5\u786e\u5b9a\u6bcf\u4e2a\u5e94\u7528\u7684\u6b63\u6587\u7c7b\u578b\u3002 \u793a\u4f8b\u4e2d\u95f4\u4ef6\u53ef\u80fd\u662f\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"app.use(async (ctx, next) => {\n  await next()\n\n  ctx.assert.equal('object', typeof ctx, 500, '\u67d0\u4e9b\u5f00\u53d1\u9519\u8bef')\n})\n"})}),"\n",(0,i.jsx)(n.h4,{id:"string",children:"String"}),"\n",(0,i.jsx)(n.p,{children:"Content-Type \u9ed8\u8ba4\u4e3a text/html \u6216 text/plain, \u540c\u65f6\u9ed8\u8ba4\u5b57\u7b26\u96c6\u662f utf-8\u3002Content-Length \u5b57\u6bb5\u4e5f\u662f\u5982\u6b64\u3002"}),"\n",(0,i.jsx)(n.h4,{id:"buffer",children:"Buffer"}),"\n",(0,i.jsx)(n.p,{children:"Content-Type \u9ed8\u8ba4\u4e3a application/octet-stream, \u5e76\u4e14 Content-Length \u5b57\u6bb5\u4e5f\u662f\u5982\u6b64\u3002"}),"\n",(0,i.jsx)(n.h4,{id:"stream",children:"Stream"}),"\n",(0,i.jsx)(n.p,{children:"Content-Type \u9ed8\u8ba4\u4e3a application/octet-stream\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u6bcf\u5f53\u6d41\u88ab\u8bbe\u7f6e\u4e3a\u54cd\u5e94\u4e3b\u4f53\u65f6\uff0c.onerror \u4f5c\u4e3a\u4fa6\u542c\u5668\u81ea\u52a8\u6dfb\u52a0\u5230 error \u4e8b\u4ef6\u4e2d\u4ee5\u6355\u83b7\u4efb\u4f55\u9519\u8bef\u3002\u6b64\u5916\uff0c\u6bcf\u5f53\u8bf7\u6c42\u5173\u95ed\uff08\u751a\u81f3\u8fc7\u65e9\uff09\u65f6\uff0c\u6d41\u90fd\u5c06\u88ab\u9500\u6bc1\u3002\u5982\u679c\u4f60\u4e0d\u60f3\u8981\u8fd9\u4e24\u4e2a\u529f\u80fd\uff0c\u8bf7\u52ff\u76f4\u63a5\u5c06\u6d41\u8bbe\u4e3a\u4e3b\u4f53\u3002\u4f8b\u5982\uff0c\u5f53\u5c06\u4e3b\u4f53\u8bbe\u7f6e\u4e3a\u4ee3\u7406\u4e2d\u7684 HTTP \u6d41\u65f6\uff0c\u4f60\u53ef\u80fd\u4e0d\u60f3\u8981\u8fd9\u6837\u505a\uff0c\u56e0\u4e3a\u5b83\u4f1a\u7834\u574f\u5e95\u5c42\u8fde\u63a5\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u53c2\u9605: ",(0,i.jsx)(n.a,{href:"https://github.com/koajs/koa/pull/612",children:"https://github.com/koajs/koa/pull/612"})," \u83b7\u53d6\u66f4\u591a\u4fe1\u606f\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u4ee5\u4e0b\u662f\u6d41\u9519\u8bef\u5904\u7406\u7684\u793a\u4f8b\uff0c\u800c\u4e0d\u4f1a\u81ea\u52a8\u7834\u574f\u6d41\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"const PassThrough = require('stream').PassThrough;\n\napp.use(async ctx => {\n  ctx.body = someHTTPStream.on('error', (err) => ctx.onerror(err)).pipe(PassThrough());\n});\n"})}),"\n",(0,i.jsx)(n.h4,{id:"object",children:"Object"}),"\n",(0,i.jsxs)(n.p,{children:["Content-Type \u9ed8\u8ba4\u4e3a application/json. \u8fd9\u5305\u62ec\u666e\u901a\u7684\u5bf9\u8c61 ",(0,i.jsx)(n.code,{children:"{ foo: 'bar' }"})," \u548c\u6570\u7ec4 ",(0,i.jsx)(n.code,{children:"['foo', 'bar']"}),"\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"responsegetfield",children:"response.get(field)"}),"\n",(0,i.jsx)(n.p,{children:"\u4e0d\u533a\u5206\u5927\u5c0f\u5199\u83b7\u53d6\u54cd\u5e94\u5934\u5b57\u6bb5\u503c field\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"const etag = ctx.response.get('ETag');\n"})}),"\n",(0,i.jsx)(n.h3,{id:"responsehasfield",children:"response.has(field)"}),"\n",(0,i.jsx)(n.p,{children:"\u5982\u679c\u5f53\u524d\u5728\u54cd\u5e94\u5934\u4e2d\u8bbe\u7f6e\u4e86\u7531\u540d\u79f0\u6807\u8bc6\u7684\u6d88\u606f\u5934\uff0c\u5219\u8fd4\u56de true. \u6d88\u606f\u5934\u540d\u79f0\u5339\u914d\u4e0d\u533a\u5206\u5927\u5c0f\u5199."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"const rateLimited = ctx.response.has('X-RateLimit-Limit');\n\n### response.set(field, value)\n\n\u8bbe\u7f6e\u54cd\u5e94\u5934 field \u5230 value:\n\n```javascript\nctx.set('Cache-Control', 'no-cache');\n"})}),"\n",(0,i.jsx)(n.h3,{id:"responseappendfield-value",children:"response.append(field, value)"}),"\n",(0,i.jsx)(n.p,{children:"\u7528\u503c val \u9644\u52a0\u989d\u5916\u7684\u6d88\u606f\u5934 field\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"ctx.append('Link', '<http://127.0.0.1/>');\n"})}),"\n",(0,i.jsx)(n.h3,{id:"responsesetfields",children:"response.set(fields)"}),"\n",(0,i.jsx)(n.p,{children:"\u7528\u4e00\u4e2a\u5bf9\u8c61\u8bbe\u7f6e\u591a\u4e2a\u54cd\u5e94\u5934fields:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"ctx.set({\n  'Etag': '1234',\n  'Last-Modified': date\n});\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u8fd9\u5c06\u59d4\u6258\u7ed9 setHeader \uff0c\u5b83\u901a\u8fc7\u6307\u5b9a\u7684\u952e\u8bbe\u7f6e\u6216\u66f4\u65b0\u6d88\u606f\u5934\uff0c\u5e76\u4e14\u4e0d\u91cd\u7f6e\u6574\u4e2a\u6d88\u606f\u5934\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"responseremovefield",children:"response.remove(field)"}),"\n",(0,i.jsx)(n.p,{children:"\u5220\u9664\u6d88\u606f\u5934 field\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"responsetype",children:"response.type"}),"\n",(0,i.jsx)(n.p,{children:'\u83b7\u53d6\u54cd\u5e94 Content-Type, \u4e0d\u542b "charset" \u7b49\u53c2\u6570\u3002'}),"\n",(0,i.jsx)(n.p,{children:"\u8bd1\u8005\u6ce8: \u8fd9\u91cc\u5176\u5b9e\u662f\u53ea\u83b7\u53d6 mime-type, \u8be6\u89c1\u6e90\u7801\u53ca\u5176\u6ce8\u91ca"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:'const ct = ctx.type;\n// => "image/png"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"responsetype-1",children:"response.type="}),"\n",(0,i.jsx)(n.p,{children:"\u8bbe\u7f6e\u54cd\u5e94 Content-Type \u901a\u8fc7 mime \u5b57\u7b26\u4e32\u6216\u6587\u4ef6\u6269\u5c55\u540d\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"ctx.type = 'text/plain; charset=utf-8';\nctx.type = 'image/png';\nctx.type = '.png';\nctx.type = 'png';\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u6ce8\u610f: \u5728\u9002\u5f53\u7684\u60c5\u51b5\u4e0b\u4e3a\u4f60\u9009\u62e9 charset, \u6bd4\u5982 response.type = 'html' \u5c06\u9ed8\u8ba4\u662f \"utf-8\". \u5982\u679c\u4f60\u60f3\u8986\u76d6 charset, \u4f7f\u7528 ctx.set('Content-Type', 'text/html') \u5c06\u54cd\u5e94\u5934\u5b57\u6bb5\u8bbe\u7f6e\u4e3a\u76f4\u63a5\u503c\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"responseistypes",children:"response.is(types...)"}),"\n",(0,i.jsx)(n.p,{children:"\u975e\u5e38\u7c7b\u4f3c ctx.request.is(). \u68c0\u67e5\u54cd\u5e94\u7c7b\u578b\u662f\u5426\u662f\u6240\u63d0\u4f9b\u7684\u7c7b\u578b\u4e4b\u4e00\u3002\u8fd9\u5bf9\u4e8e\u521b\u5efa\u64cd\u7eb5\u54cd\u5e94\u7684\u4e2d\u95f4\u4ef6\u7279\u522b\u6709\u7528\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u4f8b\u5982, \u8fd9\u662f\u4e00\u4e2a\u4e2d\u95f4\u4ef6\uff0c\u53ef\u4ee5\u524a\u51cf\u9664\u6d41\u4e4b\u5916\u7684\u6240\u6709HTML\u54cd\u5e94\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"const minify = require('html-minifier');\n\napp.use(async (ctx, next) => {\n  await next();\n\n  if (!ctx.response.is('html')) return;\n\n  let body = ctx.body;\n  if (!body || body.pipe) return;\n\n  if (Buffer.isBuffer(body)) body = body.toString();\n  ctx.body = minify(body);\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"responseredirecturl-alt",children:"response.redirect(url, [alt])"}),"\n",(0,i.jsx)(n.p,{children:"\u6267\u884c [302] \u91cd\u5b9a\u5411\u5230 url."}),"\n",(0,i.jsx)(n.p,{children:"\u5b57\u7b26\u4e32 \u201cback\u201d \u662f\u7279\u522b\u63d0\u4f9b Referrer \u652f\u6301\u7684\uff0c\u5f53 Referrer \u4e0d\u5b58\u5728\u65f6\uff0c\u4f7f\u7528 alt \u6216 \u201c/\u201d\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"ctx.redirect('back');\nctx.redirect('back', '/index.html');\nctx.redirect('/login');\nctx.redirect('http://google.com');\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u8981\u66f4\u6539 \u201c302\u201d \u7684\u9ed8\u8ba4\u72b6\u6001\uff0c\u53ea\u9700\u5728\u8be5\u8c03\u7528\u4e4b\u524d\u6216\u4e4b\u540e\u7ed9 status \u8d4b\u503c\u3002\u8981\u53d8\u66f4\u4e3b\u4f53\u8bf7\u5728\u6b64\u8c03\u7528\u4e4b\u540e:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"ctx.status = 301;\nctx.redirect('/cart');\nctx.body = 'Redirecting to shopping cart';\n"})}),"\n",(0,i.jsx)(n.h3,{id:"responseattachmentfilename-options",children:"response.attachment([filename], [options])"}),"\n",(0,i.jsx)(n.p,{children:"\u5c06 Content-Disposition \u8bbe\u7f6e\u4e3a \u201c\u9644\u4ef6\u201d \u4ee5\u6307\u793a\u5ba2\u6237\u7aef\u63d0\u793a\u4e0b\u8f7d\u3002(\u53ef\u9009)\u6307\u5b9a\u4e0b\u8f7d\u7684 filename \u548c\u90e8\u5206 \u53c2\u6570\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"responseheadersent",children:"response.headerSent"}),"\n",(0,i.jsx)(n.p,{children:"\u68c0\u67e5\u662f\u5426\u5df2\u7ecf\u53d1\u9001\u4e86\u4e00\u4e2a\u54cd\u5e94\u5934\u3002 \u7528\u4e8e\u67e5\u770b\u5ba2\u6237\u7aef\u662f\u5426\u53ef\u80fd\u4f1a\u6536\u5230\u9519\u8bef\u901a\u77e5\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"responselastmodified",children:"response.lastModified"}),"\n",(0,i.jsx)(n.p,{children:"\u5c06 Last-Modified \u6d88\u606f\u5934\u8fd4\u56de\u4e3a Date, \u5982\u679c\u5b58\u5728\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"responselastmodified-1",children:"response.lastModified="}),"\n",(0,i.jsx)(n.p,{children:"\u5c06 Last-Modified \u6d88\u606f\u5934\u8bbe\u7f6e\u4e3a\u9002\u5f53\u7684 UTC \u5b57\u7b26\u4e32\u3002\u60a8\u53ef\u4ee5\u5c06\u5176\u8bbe\u7f6e\u4e3a Date \u6216\u65e5\u671f\u5b57\u7b26\u4e32\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"ctx.response.lastModified = new Date();\n"})}),"\n",(0,i.jsx)(n.h3,{id:"responseetag",children:"response.etag="}),"\n",(0,i.jsx)(n.p,{children:'\u8bbe\u7f6e\u5305\u542b " \u5305\u88f9\u7684 ETag \u54cd\u5e94\uff0c \u8bf7\u6ce8\u610f\uff0c\u6ca1\u6709\u76f8\u5e94\u7684 response.etag getter\u3002'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"ctx.response.etag = crypto.createHash('md5').update(ctx.body).digest('hex');\n"})}),"\n",(0,i.jsx)(n.h3,{id:"responsevaryfield",children:"response.vary(field)"}),"\n",(0,i.jsx)(n.p,{children:"\u8bbe\u7f6e field \u7684 vary\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"responseflushheaders",children:"response.flushHeaders()"}),"\n",(0,i.jsx)(n.p,{children:"\u5237\u65b0\u4efb\u4f55\u8bbe\u7f6e\u7684\u6d88\u606f\u5934\uff0c\u7136\u540e\u662f\u4e3b\u4f53(body)\u3002"})]})}function p(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);